import{a as E}from"./chunk-TA72PURZ.js";import{a as T}from"./chunk-4MHKQR7U.js";import{a as k}from"./chunk-MMUSKXOL.js";import"./chunk-3BA7FMGK.js";import"./chunk-YVT3WIWJ.js";import"./chunk-OUIXM5MW.js";import"./chunk-P74D5YH2.js";import{f as L,j as w}from"./chunk-AGUO72EF.js";import{$a as x,Ia as c,Lb as F,Oa as p,Pa as f,Qa as _,Ra as b,Sa as a,Sb as P,Ta as n,Ua as g,Xa as l,Y as h,eb as s,gb as m,mb as y,ob as C,pb as j,ya as r,za as d}from"./chunk-NTXE5QSV.js";import{a as v,b as S}from"./chunk-GAL4ENT6.js";function $(i,e){i&1&&(a(0,"div",1),g(1,"app-loading"),n())}function A(i,e){if(i&1&&(s(0),C(1,"date")),i&2){let t=l(2).$implicit;m(" ",j(1,1,t.lastPost.p_date,"dd/MM/yyyy, HH:mm")," ")}}function B(i,e){if(i&1&&(a(0,"div",6)(1,"a",7),s(2),n(),a(3,"span",8),s(4," Dernier message : "),c(5,A,2,4),n()()),i&2){let t=l().$implicit;r(),x("routerLink","/forum/subject/",t.s_id,""),r(),m(" ",t.s_title," "),r(3),p(t.lastPost?5:-1)}}function W(i,e){if(i&1&&c(0,B,6,4,"div",6),i&2){let t=e.$implicit,o=l().$implicit;p(o.c_id===t.s_categorie_id?0:-1)}}function H(i,e){if(i&1&&(a(0,"div",2)(1,"div",3)(2,"a",4),s(3),n(),a(4,"i",5),s(5,"(les 5 derniers sujets actifs sont affich\xE9s)"),n()(),_(6,W,1,1,null,null,f),n()),i&2){let t=e.$implicit,o=l();r(2),x("routerLink","/forum/categorie/",t.c_id,""),r(),m(" ",t.c_title," "),r(3),b(o.linkedSubjects)}}var I=class i{constructor(e,t){this.titleService=e;this.forumService=t;this.titleService.setTitle("Cr\xE9aquest - Forum")}allCategories;allSubjects;allPosts;linkedSubjects=[];isCatLoading=!0;isSubLoading=!0;isPostLoading=!0;ngOnInit(){this.forumService.getAllCategories().subscribe({next:e=>{this.allCategories=e,this.isCatLoading=!1},error:e=>console.error("Erreur lors de la r\xE9cup\xE9ration des cat\xE9gories",e)}),this.forumService.getAllSubjects().subscribe({next:e=>{this.allSubjects=e,this.tryLinkSubjectsWithPosts(),this.isSubLoading=!1},error:e=>console.error("Erreur lors de la r\xE9cup\xE9ration des cat\xE9gories",e)}),this.forumService.getAllPosts().subscribe({next:e=>{this.allPosts=e,this.tryLinkSubjectsWithPosts(),this.isPostLoading=!1},error:e=>console.error("Erreur lors de la r\xE9cup\xE9ration des cat\xE9gories",e)})}tryLinkSubjectsWithPosts(){if(!this.allSubjects||!this.allPosts){console.warn("Subjects ou posts pas encore charg\xE9s");return}let e=this.allSubjects.map(t=>{let D=this.allPosts.filter(u=>u.p_subject_id===t.s_id).sort((u,M)=>new Date(M.p_date).getTime()-new Date(u.p_date).getTime())[0];return S(v({},t),{lastPost:D})});this.linkedSubjects=e.filter(t=>t.lastPost).sort((t,o)=>new Date(o.lastPost.p_date).getTime()-new Date(t.lastPost.p_date).getTime()).slice(0,5)}static \u0275fac=function(t){return new(t||i)(d(P),d(E))};static \u0275cmp=h({type:i,selectors:[["app-forum"]],standalone:!0,features:[y],decls:5,vars:1,consts:[[1,"relative","top-[160px]","md:top-[125px]","mx-20","pb-[45px]"],[1,"text-orange","w-full","flex","justify-center"],[1,"w-full"],[1,"w-full","bg-blue","rounded","px-4","py-2","mb-[24px]","text-white-base","hover:bg-white-base","hover:text-blue"],[1,"text-2xl","font-revalia",3,"routerLink"],[1,"text-xs"],[1,"w-9/10","flex","flex-wrap","justify-between","bg-orange","text-white-base","hover:bg-white-base","hover:text-orange","rounded-sm","mx-auto","my-1","px-2","py-1","last:mb-[40px]","font-revalia"],[3,"routerLink"],[1,"font-helvetica"]],template:function(t,o){t&1&&(g(0,"app-user-snippet"),a(1,"div",0),c(2,$,2,0,"div",1),_(3,H,8,3,"div",2,f),n()),t&2&&(r(2),p(o.isCatLoading&&o.isSubLoading&&o.isPostLoading?2:-1),r(),b(o.allCategories))},dependencies:[w,L,F,T,k]})};export{I as ForumComponent};
